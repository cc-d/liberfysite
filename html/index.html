<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Website and status tracker for all liberfy.ai services/projects"
    />
    <meta name="author" content="Cary Carter" />

    <!-- Remove before production -->
    <!-- <meta http-equiv="refresh" content="100" /> -->

    <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="img/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="img/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="img/favicon-16x16.png"
    />
    <link rel="manifest" href="site.webmanifest" />
    <link rel="stylesheet" href="css/index.css" />
    <title>liberfy.ai - status/info</title>
    <script src="js/index.js"></script>
    <script src="js/stats.js"></script>
  </head>

  <body>
    <div id="content">
      <div id="header">
        <a class="invis-link" href="https://liberfy.ai">
          <img src="img/liberfy.png" alt="liberfy.ai logo" />
          <h1>liberfy.ai</h1>
        </a>
      </div>
      <div id="projects-container">
        <div id="projects">
          <div class="project">
            <div class="project-info">
              <h1>liberfy.ai</h1>
              <p>
                Website and status tracker for all liberfy.ai services/projects.
              </p>
              <a href="https://github.com/cc-d/liberfysite">GitHub</a>
              <a href="https://liberfy.ai">Website</a>
            </div>
            <div class="site-stats" id="stats-liberfy.ai"></div>
          </div>
          <div class="project">
            <div class="project-info">
              <h1>open2fa</h1>

              <p>
                TOTP 2FA client and server, with secure remote 2FA code
                generation and sync/restore capabilities.
              </p>
              <a href="https://github.com/cc-d/open2fa">GitHub (client)</a>
              <a href="https://github.com/cc-d/open2fa-server"
                >GitHub (server)</a
              >
              <a href="https://open2fa.liberfy.ai">Website</a>
            </div>
            <div class="site-stats" id="stats-open2fa.liberfy.ai"></div>
          </div>
          <div class="project">
            <div class="project-info">
              <h1>liberlife</h1>
              <p>
                Helps to track life responsibilities and goals, has a very nice
                frontend ui
              </p>
              <a href="https://github.com/cc-d/liberlife">GitHub</a>
              <a href="https://life.liberfy.ai">Website</a>
              <a href="https://life.liberfy.ai/demo">Demo</a>
            </div>
            <div class="site-stats" id="stats-life.liberfy.ai"></div>
          </div>
          <div class="project">
            <div class="project-info">
              <h1>global</h1>
              <p>
                My global repo, containing utilities and scripts I use across
                all work environments.
              </p>
              <a href="https://github.com/cc-d/global">GitHub</a>
            </div>
          </div>
          <div class="project">
            <div class="project-info">
              <h1>flask-simple-captcha</h1>
              <p>
                A simple captcha for flask utilizing already included imports
                that does not require server side sessions
              </p>
              <a href="https://github.com/cc-d/flask-simple-captcha">GitHub</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Assuming stats is structured as { 'https://example.com': { 'avg': 100, 'ok': 90, 'error': 10 } }
        for (const [url, data] of Object.entries(stats)) {
          console.log(`Stats for ${url}: `, data);
          const statElem = document.querySelector(
            `[id="stats-${url.split('://')[1]}"]`
          );
          if (statElem) {
            const avgMs = data.avg.toFixed(2);
            const avgOk = (((data.ok + data.notok) / data.ok) * 100).toFixed(2);
            if (data?.last_status !== undefined) {
              const lastStatus = data.last_status === 200 ? 'Online' : 'Unknown';
              statElem.innerText = `Status: ${lastStatus}\nUptime: ${avgOk}% ${avgMs}ms`;
            } else {
              statElem.innerText = `Uptime: ${avgOk}% ${avgMs}ms`;
            }


          }
        }
      });
    </script>
  </body>
</html>
